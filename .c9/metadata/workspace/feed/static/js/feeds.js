{"changed":true,"filter":false,"title":"feeds.js","tooltip":"/feed/static/js/feeds.js","value":"$(function () {\n  var page_title = $(document).attr(\"title\");\n\n  function hide_stream_update() {\n    $(\".stream-update\").hide();\n    $(\".stream-update .new-posts\").text(\"\");\n    $(document).attr(\"title\", page_title);\n  };\n\n  $(\"body\").keydown(function (evt) {\n    var keyCode = evt.which?evt.which:evt.keyCode;\n    if (evt.ctrlKey && keyCode == 80) {\n      $(\".btn-compose\").click();\n      return false;\n    }\n  });\n\n  $(\"#compose-form textarea[name='post']\").keydown(function (evt) {\n    var keyCode = evt.which?evt.which:evt.keyCode;\n    if (evt.ctrlKey && (keyCode == 10 || keyCode == 13)) {\n      $(\".btn-post\").click();\n    }\n  });\n\n  $(\".btn-compose\").click(function () {\n    if ($(\".compose\").hasClass(\"composing\")) {\n      $(\".compose\").removeClass(\"composing\");\n      $(\".compose\").slideUp();\n    }\n    else {\n      $(\".compose\").addClass(\"composing\");\n      $(\".compose textarea\").val(\"\");\n      $(\".compose\").slideDown(400, function () {\n        $(\".compose textarea\").focus();\n      });\n    }\n  });\n\n  $(\".btn-cancel-compose\").click(function () {\n    $(\".compose\").slideUp();\n  });\n\n  $(\".btn-post\").click(function () {\n    var last_feed = $(\".stream li:first-child\").attr(\"feed-id\");\n    if (last_feed == undefined) {\n      last_feed = \"0\";\n    }\n    $(\"#compose-form input[name='last_feed']\").val(last_feed);\n    $.ajax({\n      url: '/feeds/post/',\n      data: $(\"#compose-form\").serialize(),\n      type: 'post',\n      cache: false,\n      success: function (data) {\n        $(\"ul.stream\").prepend(data);\n        $(\".compose\").slideUp();\n        $(\".compose\").removeClass(\"composing\");\n        hide_stream_update();\n      }\n    });\n  });\n\n  $(\"ul.stream\").on(\"click\", \".like\", function () {\n    var li = $(this).closest(\"li\");\n    var feed = $(li).attr(\"feed-id\");\n    var csrf = $(li).attr(\"csrf\");\n    $.ajax({\n      url: '/feeds/like/',\n      data: {\n        'feed': feed,\n        'csrfmiddlewaretoken': csrf\n      },\n      type: 'post',\n      cache: false,\n      success: function (data) {\n        if ($(\".like\", li).hasClass(\"unlike\")) {\n          $(\".like\", li).removeClass(\"unlike\");\n          $(\".like .text\", li).text(\"Like\");\n        }\n        else {\n          $(\".like\", li).addClass(\"unlike\");\n          $(\".like .text\", li).text(\"Unlike\");\n        }\n        $(\".like .like-count\", li).text(data);\n      }\n    });\n    return false;\n  });\n\n  $(\"ul.stream\").on(\"click\", \".comment\", function () { \n    var post = $(this).closest(\".post\");\n    if ($(\".comments\", post).hasClass(\"tracking\")) {\n      $(\".comments\", post).slideUp();\n      $(\".comments\", post).removeClass(\"tracking\");\n    }\n    else {\n      $(\".comments\", post).show();\n      $(\".comments\", post).addClass(\"tracking\");\n      $(\".comments input[name='post']\", post).focus();\n      var feed = $(post).closest(\"li\").attr(\"feed-id\");\n      $.ajax({\n        url: '/feeds/comment/',\n        data: { 'feed': feed },\n        cache: false,\n        beforeSend: function () {\n          $(\"ol\", post).html(\"<li class='loadcomment'><img src='/static/img/loading.gif'></li>\");\n        },\n        success: function (data) {\n          $(\"ol\", post).html(data);\n          $(\".comment-count\", post).text($(\"ol li\", post).not(\".empty\").length);\n        }\n      });\n    }\n    return false;\n  });\n\n  $(\"ul.stream\").on(\"keydown\", \".comments input[name='post']\", function (evt) {\n    var keyCode = evt.which?evt.which:evt.keyCode;\n    if (keyCode == 13) {\n      var form = $(this).closest(\"form\");\n      var container = $(this).closest(\".comments\");\n      var input = $(this);\n      $.ajax({\n        url: '/feeds/comment/',\n        data: $(form).serialize(),\n        type: 'post',\n        cache: false,\n        beforeSend: function () {\n          $(input).val(\"\");\n        },\n        success: function (data) {\n          $(\"ol\", container).html(data);\n          var post_container = $(container).closest(\".post\");\n          $(\".comment-count\", post_container).text($(\"ol li\", container).length);\n        }\n      });\n      return false;\n    }\n  });\n\n  var load_feeds = function () {\n    if (!$(\"#load_feed\").hasClass(\"no-more-feeds\")) {\n      var page = $(\"#load_feed input[name='page']\").val();\n      var next_page = parseInt($(\"#load_feed input[name='page']\").val()) + 1;\n      $(\"#load_feed input[name='page']\").val(next_page);\n      $.ajax({\n        url: '/feeds/load/',\n        data: $(\"#load_feed\").serialize(),\n        cache: false,\n        beforeSend: function () {\n          $(\".load\").show();\n        },\n        success: function (data) {\n          if (data.length > 0) {\n            $(\"ul.stream\").append(data)\n          }\n          else {\n            $(\"#load_feed\").addClass(\"no-more-feeds\");\n          }\n        },\n        complete: function () {\n          $(\".load\").hide();\n        }\n      });\n    }\n  };\n\n  $(\"#load_feed\").bind(\"enterviewport\", load_feeds).bullseye();\n\n  function check_new_feeds () {\n    var last_feed = $(\".stream li:first-child\").attr(\"feed-id\");\n    var feed_source = $(\"#feed_source\").val();\n    if (last_feed != undefined) {\n      $.ajax({\n        url: '/feeds/check/',\n        data: {\n          'last_feed': last_feed,\n          'feed_source': feed_source\n        },\n        cache: false,\n        success: function (data) {\n          if (parseInt(data) > 0) {\n            $(\".stream-update .new-posts\").text(data);\n            $(\".stream-update\").show();\n            $(document).attr(\"title\", \"(\" + data + \") \" + page_title);\n          }\n        },\n        complete: function() {\n          window.setTimeout(check_new_feeds, 30000);\n        }\n      });\n    }\n    else {\n      window.setTimeout(check_new_feeds, 30000);\n    }\n  };\n  check_new_feeds();\n\n  $(\".stream-update a\").click(function () {\n    var last_feed = $(\".stream li:first-child\").attr(\"feed-id\");\n    var feed_source = $(\"#feed_source\").val();\n    $.ajax({\n      url: '/feeds/load_new/',\n      data: { \n        'last_feed': last_feed,\n        'feed_source': feed_source\n      },\n      cache: false,\n      success: function (data) {\n        $(\"ul.stream\").prepend(data);\n      },\n      complete: function () {\n        hide_stream_update();\n      }\n    });\n    return false;\n  });\n\n  $(\"input,textarea\").attr(\"autocomplete\", \"off\");\n\n  function update_feeds () {\n    var first_feed = $(\".stream li:first-child\").attr(\"feed-id\");\n    var last_feed = $(\".stream li:last-child\").attr(\"feed-id\");\n    var feed_source = $(\"#feed_source\").val();\n\n    if (first_feed != undefined && last_feed != undefined) {\n      $.ajax({\n        url: '/feeds/update/',\n        data: {\n          'first_feed': first_feed,\n          'last_feed': last_feed,\n          'feed_source': feed_source\n        },\n        cache: false,\n        success: function (data) {\n          $.each(data, function(id, feed) {\n              var li = $(\"li[feed-id='\" + id + \"']\");\n              $(\".like-count\", li).text(feed.likes);\n              $(\".comment-count\", li).text(feed.comments);\n          });\n        },\n        complete: function () {\n          window.setTimeout(update_feeds, 30000);\n        }\n      });\n    }\n    else {\n      window.setTimeout(update_feeds, 30000);\n    }\n  };\n  update_feeds();\n\n  function track_comments () {\n    $(\".tracking\").each(function () {\n      var container = $(this);\n      var feed = $(this).closest(\"li\").attr(\"feed-id\");\n      $.ajax({\n        url: '/feeds/track_comments/',\n        data: {'feed': feed},\n        cache: false,\n        success: function (data) {\n          $(\"ol\", container).html(data);\n          var post_container = $(container).closest(\".post\");\n          $(\".comment-count\", post_container).text($(\"ol li\", container).length);\n        }\n      });\n    });\n    window.setTimeout(track_comments, 30000);\n  };\n  track_comments();\n\n  $(\"ul.stream\").on(\"click\", \".remove-feed\", function () {\n    var li = $(this).closest(\"li\");\n    var feed = $(li).attr(\"feed-id\");\n    var csrf = $(li).attr(\"csrf\");\n    $.ajax({\n      url: '/feeds/remove/',\n      data: {\n        'feed': feed,\n        'csrfmiddlewaretoken': csrf\n      },\n      type: 'post',\n      cache: false,\n      success: function (data) {\n        $(li).fadeOut(400, function () {\n          $(li).remove();\n        });\n      }\n    });\n  });\n\n  $(\"#compose-form textarea[name='post']\").keyup(function () {\n    $(this).count(255);\n  });\n\n});","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":295,"column":3},"action":"insert","lines":["$(function () {","  var page_title = $(document).attr(\"title\");","","  function hide_stream_update() {","    $(\".stream-update\").hide();","    $(\".stream-update .new-posts\").text(\"\");","    $(document).attr(\"title\", page_title);","  };","","  $(\"body\").keydown(function (evt) {","    var keyCode = evt.which?evt.which:evt.keyCode;","    if (evt.ctrlKey && keyCode == 80) {","      $(\".btn-compose\").click();","      return false;","    }","  });","","  $(\"#compose-form textarea[name='post']\").keydown(function (evt) {","    var keyCode = evt.which?evt.which:evt.keyCode;","    if (evt.ctrlKey && (keyCode == 10 || keyCode == 13)) {","      $(\".btn-post\").click();","    }","  });","","  $(\".btn-compose\").click(function () {","    if ($(\".compose\").hasClass(\"composing\")) {","      $(\".compose\").removeClass(\"composing\");","      $(\".compose\").slideUp();","    }","    else {","      $(\".compose\").addClass(\"composing\");","      $(\".compose textarea\").val(\"\");","      $(\".compose\").slideDown(400, function () {","        $(\".compose textarea\").focus();","      });","    }","  });","","  $(\".btn-cancel-compose\").click(function () {","    $(\".compose\").slideUp();","  });","","  $(\".btn-post\").click(function () {","    var last_feed = $(\".stream li:first-child\").attr(\"feed-id\");","    if (last_feed == undefined) {","      last_feed = \"0\";","    }","    $(\"#compose-form input[name='last_feed']\").val(last_feed);","    $.ajax({","      url: '/feeds/post/',","      data: $(\"#compose-form\").serialize(),","      type: 'post',","      cache: false,","      success: function (data) {","        $(\"ul.stream\").prepend(data);","        $(\".compose\").slideUp();","        $(\".compose\").removeClass(\"composing\");","        hide_stream_update();","      }","    });","  });","","  $(\"ul.stream\").on(\"click\", \".like\", function () {","    var li = $(this).closest(\"li\");","    var feed = $(li).attr(\"feed-id\");","    var csrf = $(li).attr(\"csrf\");","    $.ajax({","      url: '/feeds/like/',","      data: {","        'feed': feed,","        'csrfmiddlewaretoken': csrf","      },","      type: 'post',","      cache: false,","      success: function (data) {","        if ($(\".like\", li).hasClass(\"unlike\")) {","          $(\".like\", li).removeClass(\"unlike\");","          $(\".like .text\", li).text(\"Like\");","        }","        else {","          $(\".like\", li).addClass(\"unlike\");","          $(\".like .text\", li).text(\"Unlike\");","        }","        $(\".like .like-count\", li).text(data);","      }","    });","    return false;","  });","","  $(\"ul.stream\").on(\"click\", \".comment\", function () { ","    var post = $(this).closest(\".post\");","    if ($(\".comments\", post).hasClass(\"tracking\")) {","      $(\".comments\", post).slideUp();","      $(\".comments\", post).removeClass(\"tracking\");","    }","    else {","      $(\".comments\", post).show();","      $(\".comments\", post).addClass(\"tracking\");","      $(\".comments input[name='post']\", post).focus();","      var feed = $(post).closest(\"li\").attr(\"feed-id\");","      $.ajax({","        url: '/feeds/comment/',","        data: { 'feed': feed },","        cache: false,","        beforeSend: function () {","          $(\"ol\", post).html(\"<li class='loadcomment'><img src='/static/img/loading.gif'></li>\");","        },","        success: function (data) {","          $(\"ol\", post).html(data);","          $(\".comment-count\", post).text($(\"ol li\", post).not(\".empty\").length);","        }","      });","    }","    return false;","  });","","  $(\"ul.stream\").on(\"keydown\", \".comments input[name='post']\", function (evt) {","    var keyCode = evt.which?evt.which:evt.keyCode;","    if (keyCode == 13) {","      var form = $(this).closest(\"form\");","      var container = $(this).closest(\".comments\");","      var input = $(this);","      $.ajax({","        url: '/feeds/comment/',","        data: $(form).serialize(),","        type: 'post',","        cache: false,","        beforeSend: function () {","          $(input).val(\"\");","        },","        success: function (data) {","          $(\"ol\", container).html(data);","          var post_container = $(container).closest(\".post\");","          $(\".comment-count\", post_container).text($(\"ol li\", container).length);","        }","      });","      return false;","    }","  });","","  var load_feeds = function () {","    if (!$(\"#load_feed\").hasClass(\"no-more-feeds\")) {","      var page = $(\"#load_feed input[name='page']\").val();","      var next_page = parseInt($(\"#load_feed input[name='page']\").val()) + 1;","      $(\"#load_feed input[name='page']\").val(next_page);","      $.ajax({","        url: '/feeds/load/',","        data: $(\"#load_feed\").serialize(),","        cache: false,","        beforeSend: function () {","          $(\".load\").show();","        },","        success: function (data) {","          if (data.length > 0) {","            $(\"ul.stream\").append(data)","          }","          else {","            $(\"#load_feed\").addClass(\"no-more-feeds\");","          }","        },","        complete: function () {","          $(\".load\").hide();","        }","      });","    }","  };","","  $(\"#load_feed\").bind(\"enterviewport\", load_feeds).bullseye();","","  function check_new_feeds () {","    var last_feed = $(\".stream li:first-child\").attr(\"feed-id\");","    var feed_source = $(\"#feed_source\").val();","    if (last_feed != undefined) {","      $.ajax({","        url: '/feeds/check/',","        data: {","          'last_feed': last_feed,","          'feed_source': feed_source","        },","        cache: false,","        success: function (data) {","          if (parseInt(data) > 0) {","            $(\".stream-update .new-posts\").text(data);","            $(\".stream-update\").show();","            $(document).attr(\"title\", \"(\" + data + \") \" + page_title);","          }","        },","        complete: function() {","          window.setTimeout(check_new_feeds, 30000);","        }","      });","    }","    else {","      window.setTimeout(check_new_feeds, 30000);","    }","  };","  check_new_feeds();","","  $(\".stream-update a\").click(function () {","    var last_feed = $(\".stream li:first-child\").attr(\"feed-id\");","    var feed_source = $(\"#feed_source\").val();","    $.ajax({","      url: '/feeds/load_new/',","      data: { ","        'last_feed': last_feed,","        'feed_source': feed_source","      },","      cache: false,","      success: function (data) {","        $(\"ul.stream\").prepend(data);","      },","      complete: function () {","        hide_stream_update();","      }","    });","    return false;","  });","","  $(\"input,textarea\").attr(\"autocomplete\", \"off\");","","  function update_feeds () {","    var first_feed = $(\".stream li:first-child\").attr(\"feed-id\");","    var last_feed = $(\".stream li:last-child\").attr(\"feed-id\");","    var feed_source = $(\"#feed_source\").val();","","    if (first_feed != undefined && last_feed != undefined) {","      $.ajax({","        url: '/feeds/update/',","        data: {","          'first_feed': first_feed,","          'last_feed': last_feed,","          'feed_source': feed_source","        },","        cache: false,","        success: function (data) {","          $.each(data, function(id, feed) {","              var li = $(\"li[feed-id='\" + id + \"']\");","              $(\".like-count\", li).text(feed.likes);","              $(\".comment-count\", li).text(feed.comments);","          });","        },","        complete: function () {","          window.setTimeout(update_feeds, 30000);","        }","      });","    }","    else {","      window.setTimeout(update_feeds, 30000);","    }","  };","  update_feeds();","","  function track_comments () {","    $(\".tracking\").each(function () {","      var container = $(this);","      var feed = $(this).closest(\"li\").attr(\"feed-id\");","      $.ajax({","        url: '/feeds/track_comments/',","        data: {'feed': feed},","        cache: false,","        success: function (data) {","          $(\"ol\", container).html(data);","          var post_container = $(container).closest(\".post\");","          $(\".comment-count\", post_container).text($(\"ol li\", container).length);","        }","      });","    });","    window.setTimeout(track_comments, 30000);","  };","  track_comments();","","  $(\"ul.stream\").on(\"click\", \".remove-feed\", function () {","    var li = $(this).closest(\"li\");","    var feed = $(li).attr(\"feed-id\");","    var csrf = $(li).attr(\"csrf\");","    $.ajax({","      url: '/feeds/remove/',","      data: {","        'feed': feed,","        'csrfmiddlewaretoken': csrf","      },","      type: 'post',","      cache: false,","      success: function (data) {","        $(li).fadeOut(400, function () {","          $(li).remove();","        });","      }","    });","  });","","  $(\"#compose-form textarea[name='post']\").keyup(function () {","    $(this).count(255);","  });","","});"],"id":1}]]},"ace":{"folds":[],"scrolltop":4281,"scrollleft":0,"selection":{"start":{"row":295,"column":3},"end":{"row":295,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1456855362962}