{"filter":false,"title":"views.py","tooltip":"/user_profile/views.py","undoManager":{"mark":79,"position":79,"stack":[[{"start":{"row":0,"column":0},"end":{"row":3,"column":0},"action":"remove","lines":["from django.shortcuts import render","","# Create your views here.",""],"id":2},{"start":{"row":0,"column":0},"end":{"row":142,"column":63},"action":"insert","lines":["import os","from PIL import Image","","from django.contrib.auth.models import User","from django.contrib.auth.decorators import login_required","from django.contrib import messages","from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger","from django.conf import settings as django_settings","from django.shortcuts import render, redirect, get_object_or_404","","from core.forms import ProfileForm, ChangePasswordForm","from feeds.models import Feed","from feeds.views import FEEDS_NUM_PAGES","from feeds.views import feeds","","","def home(request):","    if request.user.is_authenticated():","        return feeds(request)","    else:","        return render(request, 'core/cover.html')","","@login_required","def network(request):","    users_list = User.objects.filter(is_active=True).order_by('username')","    paginator = Paginator(users_list, 10)","    page = request.GET.get('page')","    try:","        users = paginator.page(page)","    except PageNotAnInteger:","        users = paginator.page(1)","    except EmptyPage:","        users = paginator.page(paginator.num_pages)","    return render(request, 'core/network.html', { 'users': users })","","@login_required","def profile(request, username):","    user=request.user","    page_user = get_object_or_404(User, username=username)","    all_feeds = Feed.get_feeds().filter(user=page_user)","    paginator = Paginator(all_feeds, FEEDS_NUM_PAGES)","    feeds = paginator.page(1)","    from_feed = -1","    if feeds:","        from_feed = feeds[0].id","    return render(request, 'core/profile.html', {","        'page_user': page_user,","        'feeds': feeds,","        'from_feed': from_feed,","        'page': 1,","        'user':user","        })","","@login_required","def settings(request):","    user = request.user","    if request.method == 'POST':","        form = ProfileForm(request.POST)","        if form.is_valid():","            user.first_name = form.cleaned_data.get('first_name')","            user.last_name = form.cleaned_data.get('last_name')","            user.profile.job_title = form.cleaned_data.get('job_title')","            user.email = form.cleaned_data.get('email')","            user.profile.url = form.cleaned_data.get('url')","            user.profile.location = form.cleaned_data.get('location')","            user.save()","            messages.add_message(request, messages.SUCCESS, 'Your profile were successfully edited.')","    else:","        form = ProfileForm(instance=user, initial={","            'job_title': user.profile.job_title,","            'url': user.profile.url,","            'location': user.profile.location","            })","    return render(request, 'core/settings.html', {'form':form})","","@login_required","def picture(request):","    uploaded_picture = False","    try:","        if request.GET.get('upload_picture') == 'uploaded':","            uploaded_picture = True","    except Exception, e:","        pass","    return render(request, 'core/picture.html', {'uploaded_picture': uploaded_picture})","","@login_required","def password(request):","    user = request.user","    if request.method == 'POST':","        form = ChangePasswordForm(request.POST)","        if form.is_valid():","            new_password = form.cleaned_data.get('new_password')","            user.set_password(new_password)","            user.save()","            messages.add_message(request, messages.SUCCESS, 'Your password were successfully changed.')","    else:","        form = ChangePasswordForm(instance=user)","    return render(request, 'core/password.html', {'form':form})","","@login_required","def upload_picture(request):","    try:","        profile_pictures = django_settings.MEDIA_ROOT + '/profile_pictures/'","        if not os.path.exists(profile_pictures):","            os.makedirs(profile_pictures)","        f = request.FILES['picture']","        filename = profile_pictures + request.user.username + '_tmp.jpg'","        with open(filename, 'wb+') as destination:","            for chunk in f.chunks():","                destination.write(chunk)    ","        im = Image.open(filename)","        width, height = im.size","        if width > 350:","            new_width = 350","            new_height = (height * 350) / width","            new_size = new_width, new_height","            im.thumbnail(new_size, Image.ANTIALIAS)","            im.save(filename)","        return redirect('/settings/picture/?upload_picture=uploaded')","    except Exception, e:","        return redirect('/settings/picture/')","","@login_required","def save_uploaded_picture(request):","    try:","        x = int(request.POST.get('x'))","        y = int(request.POST.get('y'))","        w = int(request.POST.get('w'))","        h = int(request.POST.get('h'))","        tmp_filename = django_settings.MEDIA_ROOT + '/profile_pictures/' + request.user.username + '_tmp.jpg'","        filename = django_settings.MEDIA_ROOT + '/profile_pictures/' + request.user.username + '.jpg'","        im = Image.open(tmp_filename)","        cropped_im = im.crop((x, y, w+x, h+y))","        cropped_im.thumbnail((200, 200), Image.ANTIALIAS)","        cropped_im.save(filename)","        os.remove(tmp_filename)","    except Exception, e:","        pass","    return redirect('/settings/picture/')","","def log_out(request):","    user=request.user","    return render(request,'core/logout.html',{'user':user})    "]}],[{"start":{"row":142,"column":62},"end":{"row":142,"column":63},"action":"remove","lines":[" "],"id":3}],[{"start":{"row":142,"column":61},"end":{"row":142,"column":62},"action":"remove","lines":[" "],"id":4}],[{"start":{"row":142,"column":60},"end":{"row":142,"column":61},"action":"remove","lines":[" "],"id":5}],[{"start":{"row":142,"column":59},"end":{"row":142,"column":60},"action":"remove","lines":[" "],"id":6}],[{"start":{"row":142,"column":58},"end":{"row":142,"column":59},"action":"remove","lines":[")"],"id":7}],[{"start":{"row":142,"column":58},"end":{"row":142,"column":59},"action":"insert","lines":[")"],"id":8}],[{"start":{"row":10,"column":8},"end":{"row":10,"column":9},"action":"remove","lines":["e"],"id":9}],[{"start":{"row":10,"column":7},"end":{"row":10,"column":8},"action":"remove","lines":["r"],"id":10}],[{"start":{"row":10,"column":6},"end":{"row":10,"column":7},"action":"remove","lines":["o"],"id":11}],[{"start":{"row":10,"column":5},"end":{"row":10,"column":6},"action":"remove","lines":["c"],"id":12}],[{"start":{"row":10,"column":5},"end":{"row":10,"column":6},"action":"insert","lines":["u"],"id":13}],[{"start":{"row":10,"column":6},"end":{"row":10,"column":7},"action":"insert","lines":["s"],"id":14}],[{"start":{"row":10,"column":7},"end":{"row":10,"column":8},"action":"insert","lines":["e"],"id":15}],[{"start":{"row":10,"column":8},"end":{"row":10,"column":9},"action":"insert","lines":["r"],"id":16}],[{"start":{"row":10,"column":9},"end":{"row":10,"column":10},"action":"insert","lines":["_"],"id":17}],[{"start":{"row":10,"column":10},"end":{"row":10,"column":11},"action":"insert","lines":["p"],"id":18}],[{"start":{"row":10,"column":11},"end":{"row":10,"column":12},"action":"insert","lines":["r"],"id":19}],[{"start":{"row":10,"column":12},"end":{"row":10,"column":13},"action":"insert","lines":["o"],"id":20}],[{"start":{"row":10,"column":13},"end":{"row":10,"column":14},"action":"insert","lines":["f"],"id":21}],[{"start":{"row":10,"column":14},"end":{"row":10,"column":15},"action":"insert","lines":["i"],"id":22}],[{"start":{"row":10,"column":15},"end":{"row":10,"column":16},"action":"insert","lines":["l"],"id":23}],[{"start":{"row":10,"column":16},"end":{"row":10,"column":17},"action":"insert","lines":["e"],"id":24}],[{"start":{"row":10,"column":5},"end":{"row":10,"column":17},"action":"remove","lines":["user_profile"],"id":25},{"start":{"row":10,"column":5},"end":{"row":10,"column":17},"action":"insert","lines":["user_profile"]}],[{"start":{"row":11,"column":9},"end":{"row":11,"column":10},"action":"remove","lines":["s"],"id":26}],[{"start":{"row":12,"column":9},"end":{"row":12,"column":10},"action":"remove","lines":["s"],"id":27}],[{"start":{"row":13,"column":9},"end":{"row":13,"column":10},"action":"remove","lines":["s"],"id":28}],[{"start":{"row":11,"column":0},"end":{"row":13,"column":28},"action":"remove","lines":["from feed.models import Feed","from feed.views import FEEDS_NUM_PAGES","from feed.views import feeds"],"id":29}],[{"start":{"row":9,"column":0},"end":{"row":11,"column":28},"action":"insert","lines":["from feed.models import Feed","from feed.views import FEEDS_NUM_PAGES","from feed.views import feeds"],"id":30}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":21},"action":"remove","lines":["import os","from PIL import Image"],"id":31}],[{"start":{"row":10,"column":28},"end":{"row":11,"column":0},"action":"insert","lines":["",""],"id":32}],[{"start":{"row":11,"column":0},"end":{"row":12,"column":21},"action":"insert","lines":["import os","from PIL import Image"],"id":33}],[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"remove","lines":["",""],"id":34}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"remove","lines":["",""],"id":35}],[{"start":{"row":14,"column":0},"end":{"row":19,"column":49},"action":"remove","lines":["","def home(request):","    if request.user.is_authenticated():","        return feeds(request)","    else:","        return render(request, 'core/cover.html')"],"id":36}],[{"start":{"row":13,"column":0},"end":{"row":14,"column":0},"action":"remove","lines":["",""],"id":37}],[{"start":{"row":38,"column":31},"end":{"row":38,"column":32},"action":"remove","lines":["e"],"id":38}],[{"start":{"row":38,"column":31},"end":{"row":38,"column":32},"action":"remove","lines":["/"],"id":39}],[{"start":{"row":38,"column":30},"end":{"row":38,"column":31},"action":"remove","lines":["r"],"id":40}],[{"start":{"row":38,"column":29},"end":{"row":38,"column":30},"action":"remove","lines":["o"],"id":41}],[{"start":{"row":38,"column":28},"end":{"row":38,"column":29},"action":"remove","lines":["c"],"id":42}],[{"start":{"row":15,"column":0},"end":{"row":26,"column":67},"action":"remove","lines":["@login_required","def network(request):","    users_list = User.objects.filter(is_active=True).order_by('username')","    paginator = Paginator(users_list, 10)","    page = request.GET.get('page')","    try:","        users = paginator.page(page)","    except PageNotAnInteger:","        users = paginator.page(1)","    except EmptyPage:","        users = paginator.page(paginator.num_pages)","    return render(request, 'core/network.html', { 'users': users })"],"id":43}],[{"start":{"row":14,"column":0},"end":{"row":15,"column":0},"action":"remove","lines":["",""],"id":44}],[{"start":{"row":13,"column":0},"end":{"row":14,"column":0},"action":"remove","lines":["",""],"id":45}],[{"start":{"row":53,"column":31},"end":{"row":53,"column":32},"action":"remove","lines":["e"],"id":46}],[{"start":{"row":53,"column":30},"end":{"row":53,"column":31},"action":"remove","lines":["r"],"id":47}],[{"start":{"row":53,"column":29},"end":{"row":53,"column":30},"action":"remove","lines":["o"],"id":48}],[{"start":{"row":53,"column":28},"end":{"row":53,"column":29},"action":"remove","lines":["c"],"id":49}],[{"start":{"row":53,"column":28},"end":{"row":53,"column":29},"action":"remove","lines":["/"],"id":50}],[{"start":{"row":53,"column":35},"end":{"row":53,"column":36},"action":"remove","lines":["s"],"id":51}],[{"start":{"row":49,"column":11},"end":{"row":50,"column":36},"action":"remove","lines":[" 'job_title': user.profile.job_title,","            'url': user.profile.url,"],"id":52}],[{"start":{"row":49,"column":10},"end":{"row":49,"column":11},"action":"remove","lines":[" "],"id":53}],[{"start":{"row":49,"column":9},"end":{"row":49,"column":10},"action":"remove","lines":[" "],"id":54}],[{"start":{"row":49,"column":8},"end":{"row":49,"column":9},"action":"remove","lines":[" "],"id":55}],[{"start":{"row":49,"column":4},"end":{"row":49,"column":8},"action":"remove","lines":["    "],"id":56}],[{"start":{"row":49,"column":0},"end":{"row":49,"column":4},"action":"remove","lines":["    "],"id":57}],[{"start":{"row":48,"column":51},"end":{"row":49,"column":0},"action":"remove","lines":["",""],"id":58}],[{"start":{"row":41,"column":12},"end":{"row":41,"column":71},"action":"remove","lines":["user.profile.job_title = form.cleaned_data.get('job_title')"],"id":59}],[{"start":{"row":41,"column":8},"end":{"row":41,"column":12},"action":"remove","lines":["    "],"id":60}],[{"start":{"row":41,"column":4},"end":{"row":41,"column":8},"action":"remove","lines":["    "],"id":61}],[{"start":{"row":41,"column":0},"end":{"row":41,"column":4},"action":"remove","lines":["    "],"id":62}],[{"start":{"row":40,"column":63},"end":{"row":41,"column":0},"action":"remove","lines":["",""],"id":63}],[{"start":{"row":42,"column":12},"end":{"row":42,"column":59},"action":"remove","lines":["user.profile.url = form.cleaned_data.get('url')"],"id":64}],[{"start":{"row":42,"column":8},"end":{"row":42,"column":12},"action":"remove","lines":["    "],"id":65}],[{"start":{"row":42,"column":4},"end":{"row":42,"column":8},"action":"remove","lines":["    "],"id":66}],[{"start":{"row":42,"column":0},"end":{"row":42,"column":4},"action":"remove","lines":["    "],"id":67}],[{"start":{"row":41,"column":55},"end":{"row":42,"column":0},"action":"remove","lines":["",""],"id":68}],[{"start":{"row":59,"column":32},"end":{"row":59,"column":33},"action":"remove","lines":["/"],"id":69}],[{"start":{"row":59,"column":31},"end":{"row":59,"column":32},"action":"remove","lines":["e"],"id":70}],[{"start":{"row":59,"column":30},"end":{"row":59,"column":31},"action":"remove","lines":["r"],"id":71}],[{"start":{"row":59,"column":29},"end":{"row":59,"column":30},"action":"remove","lines":["o"],"id":72}],[{"start":{"row":59,"column":28},"end":{"row":59,"column":29},"action":"remove","lines":["c"],"id":73}],[{"start":{"row":73,"column":31},"end":{"row":73,"column":32},"action":"remove","lines":["e"],"id":74}],[{"start":{"row":73,"column":30},"end":{"row":73,"column":31},"action":"remove","lines":["r"],"id":75}],[{"start":{"row":73,"column":29},"end":{"row":73,"column":30},"action":"remove","lines":["o"],"id":76}],[{"start":{"row":73,"column":28},"end":{"row":73,"column":29},"action":"remove","lines":["c"],"id":77}],[{"start":{"row":73,"column":28},"end":{"row":73,"column":29},"action":"remove","lines":["/"],"id":78}],[{"start":{"row":94,"column":33},"end":{"row":94,"column":34},"action":"remove","lines":["s"],"id":79}],[{"start":{"row":96,"column":33},"end":{"row":96,"column":34},"action":"remove","lines":["s"],"id":80}],[{"start":{"row":114,"column":29},"end":{"row":114,"column":30},"action":"remove","lines":["s"],"id":81}]]},"ace":{"folds":[],"scrolltop":76,"scrollleft":0,"selection":{"start":{"row":4,"column":29},"end":{"row":4,"column":29},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1456858295518,"hash":"45b39d081f59378ee02b2cadae01bffc17e93b7b"}